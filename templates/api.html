<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API - Fingerprint Collector</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/simple.css">
    <script>
        (function() {
            const saved = localStorage.getItem('fingerprint-theme');
            if (saved) {
                document.documentElement.setAttribute('data-theme', saved);
            } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        })();
    </script>
    <style>
        .page-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: var(--space-xs);
        }

        .page-description {
            color: var(--text-secondary);
            font-size: 0.9375rem;
            margin-bottom: var(--space-lg);
        }

        .base-url {
            display: inline-block;
            padding: var(--space-sm) var(--space-md);
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-family: var(--font-mono);
            font-size: 0.875rem;
            color: var(--accent);
            margin-bottom: var(--space-xl);
        }

        .api-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-lg);
        }

        .api-endpoint {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }

        .api-endpoint-header {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md);
            border-bottom: 1px solid var(--border);
            background: var(--bg);
        }

        .api-method {
            padding: 4px 10px;
            font-size: 0.6875rem;
            font-weight: 600;
            text-transform: uppercase;
            border-radius: var(--radius);
            font-family: var(--font-mono);
        }

        .api-method.get {
            background: var(--success-bg);
            color: var(--success);
        }

        .api-method.post {
            background: var(--accent-bg);
            color: var(--accent);
        }

        .api-path {
            font-family: var(--font-mono);
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text);
        }

        .api-endpoint-body {
            padding: var(--space-md);
        }

        .api-description {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: var(--space-md);
        }

        .api-subsection {
            margin-bottom: var(--space-md);
        }

        .api-subsection:last-child {
            margin-bottom: 0;
        }

        .api-subsection-title {
            font-size: 0.6875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: var(--space-xs);
        }

        .api-code {
            font-family: var(--font-mono);
            font-size: 0.75rem;
            line-height: 1.7;
            background: var(--bg);
            padding: var(--space-md);
            border-radius: var(--radius);
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-all;
            color: var(--text-secondary);
        }

        .api-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8125rem;
        }

        .api-table th,
        .api-table td {
            text-align: left;
            padding: var(--space-sm);
            border-bottom: 1px solid var(--border);
        }

        .api-table th {
            font-weight: 600;
            color: var(--text-muted);
            font-size: 0.6875rem;
            text-transform: uppercase;
        }

        .api-table td {
            color: var(--text-secondary);
        }

        .api-table code {
            font-family: var(--font-mono);
            font-size: 0.75rem;
            background: var(--bg);
            padding: 2px 6px;
            border-radius: var(--radius);
        }

        .try-btn {
            margin-top: var(--space-sm);
        }

        .api-response {
            margin-top: var(--space-sm);
            display: none;
        }

        .api-response.visible {
            display: block;
        }

        .tls-section {
            margin-top: var(--space-xl);
            padding: var(--space-lg);
            background: var(--accent-bg);
            border: 1px solid var(--accent);
            border-radius: var(--radius-lg);
        }

        .tls-section h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--accent);
            margin-bottom: var(--space-md);
        }

        .tls-section p {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: var(--space-md);
        }

        .tls-section ol {
            padding-left: var(--space-lg);
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .tls-section ol li {
            margin-bottom: var(--space-xs);
        }

        .tls-section code {
            background: var(--bg-card);
            padding: 2px 6px;
            border-radius: var(--radius);
            font-family: var(--font-mono);
            font-size: 0.8125rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <svg viewBox="0 0 32 32" fill="none" class="logo-icon">
                    <circle cx="16" cy="16" r="12" stroke="currentColor" stroke-width="1.5" opacity="0.3"/>
                    <circle cx="16" cy="16" r="8" stroke="currentColor" stroke-width="1.5" opacity="0.6"/>
                    <circle cx="16" cy="16" r="4" stroke="currentColor" stroke-width="1.5"/>
                    <circle cx="16" cy="16" r="1.5" fill="currentColor"/>
                </svg>
                <span class="logo-text">Fingerprint Collector</span>
            </div>
            <nav class="nav">
                <a href="/" class="nav-link">Collect</a>
                <a href="/history" class="nav-link">History</a>
                <a href="/api-docs" class="nav-link active">API</a>
                <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
                    <svg class="sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"/><path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                    </svg>
                    <svg class="moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                    </svg>
                </button>
            </nav>
        </header>

        <!-- Main Content -->
        <main class="main">
            <!-- Page Header -->
            <section>
                <h1 class="page-title">API Documentation</h1>
                <p class="page-description">REST API for collecting and retrieving browser fingerprints</p>
                <div class="base-url" id="baseUrl">Base URL: Loading...</div>
            </section>

            <!-- API List -->
            <div class="api-list">
                <!-- POST /api/collect -->
                <article class="api-endpoint">
                    <div class="api-endpoint-header">
                        <span class="api-method post">POST</span>
                        <span class="api-path">/api/collect</span>
                    </div>
                    <div class="api-endpoint-body">
                        <p class="api-description">Submit browser fingerprint data. Server appends HTTP headers and IP.</p>
                        <div class="api-subsection">
                            <h4 class="api-subsection-title">Request Body</h4>
                            <pre class="api-code">{
  "navigator": { ... },
  "screen": { ... },
  "canvas": { "hash": "...", "geometry": "..." },
  "webgl": { ... },
  "audio": { ... },
  "fonts": [...]
}</pre>
                        </div>
                        <div class="api-subsection">
                            <h4 class="api-subsection-title">Response</h4>
                            <pre class="api-code">{
  "success": true,
  "id": "abc123def456",
  "fingerprint": { "client": {...}, "server": {...} }
}</pre>
                        </div>
                    </div>
                </article>

                <!-- GET /api/fingerprints -->
                <article class="api-endpoint">
                    <div class="api-endpoint-header">
                        <span class="api-method get">GET</span>
                        <span class="api-path">/api/fingerprints</span>
                    </div>
                    <div class="api-endpoint-body">
                        <p class="api-description">Retrieve all collected fingerprints (max 100).</p>
                        <button class="btn btn-small try-btn" data-endpoint="/api/fingerprints">Try it</button>
                        <div class="api-response" id="response-fingerprints">
                            <h4 class="api-subsection-title">Response</h4>
                            <pre class="api-code" id="response-fingerprints-content"></pre>
                        </div>
                    </div>
                </article>

                <!-- GET /api/fingerprint/:id -->
                <article class="api-endpoint">
                    <div class="api-endpoint-header">
                        <span class="api-method get">GET</span>
                        <span class="api-path">/api/fingerprint/:id</span>
                    </div>
                    <div class="api-endpoint-body">
                        <p class="api-description">Retrieve a specific fingerprint by ID.</p>
                        <div class="api-subsection">
                            <h4 class="api-subsection-title">Parameters</h4>
                            <table class="api-table">
                                <thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead>
                                <tbody><tr><td><code>id</code></td><td>string</td><td>Fingerprint ID</td></tr></tbody>
                            </table>
                        </div>
                    </div>
                </article>

                <!-- DELETE endpoints -->
                <article class="api-endpoint">
                    <div class="api-endpoint-header">
                        <span class="api-method get">GET</span>
                        <span class="api-path">/api/fingerprint/:id/delete</span>
                    </div>
                    <div class="api-endpoint-body">
                        <p class="api-description">Delete a specific fingerprint by ID.</p>
                    </div>
                </article>

                <article class="api-endpoint">
                    <div class="api-endpoint-header">
                        <span class="api-method get">GET</span>
                        <span class="api-path">/api/fingerprints/delete</span>
                    </div>
                    <div class="api-endpoint-body">
                        <p class="api-description">Delete all fingerprints.</p>
                    </div>
                </article>

                <!-- GET /api/server-info -->
                <article class="api-endpoint">
                    <div class="api-endpoint-header">
                        <span class="api-method get">GET</span>
                        <span class="api-path">/api/server-info</span>
                    </div>
                    <div class="api-endpoint-body">
                        <p class="api-description">Get server-side info only (IP, headers).</p>
                        <button class="btn btn-small try-btn" data-endpoint="/api/server-info">Try it</button>
                        <div class="api-response" id="response-server-info">
                            <h4 class="api-subsection-title">Response</h4>
                            <pre class="api-code" id="response-server-info-content"></pre>
                        </div>
                    </div>
                </article>

                <!-- GET /api/config -->
                <article class="api-endpoint">
                    <div class="api-endpoint-header">
                        <span class="api-method get">GET</span>
                        <span class="api-path">/api/config</span>
                    </div>
                    <div class="api-endpoint-body">
                        <p class="api-description">Get server configuration (TLS URL, etc.).</p>
                        <button class="btn btn-small try-btn" data-endpoint="/api/config">Try it</button>
                        <div class="api-response" id="response-config">
                            <h4 class="api-subsection-title">Response</h4>
                            <pre class="api-code" id="response-config-content"></pre>
                        </div>
                    </div>
                </article>
            </div>

            <!-- TLS Section -->
            <div class="tls-section">
                <h3>TLS Fingerprint (JA3/JA4)</h3>
                <p>TLS fingerprints require a direct connection to our Go-based TLS server.</p>
                <div class="api-subsection">
                    <h4 class="api-subsection-title">TLS Server Endpoint</h4>
                    <pre class="api-code" id="tlsServerUrl">Loading...</pre>
                </div>
                <div class="api-subsection">
                    <h4 class="api-subsection-title">Steps</h4>
                    <ol>
                        <li>Visit the TLS server URL in your browser</li>
                        <li>Accept the self-signed certificate</li>
                        <li>Access <code>/api/fingerprint</code> to get JA3/JA4</li>
                    </ol>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>Fingerprint Collector &mdash; For educational and research purposes only</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Theme toggle
            document.getElementById('themeToggle').addEventListener('click', () => {
                const current = document.documentElement.getAttribute('data-theme');
                const isDark = current === 'dark' ||
                    (!current && window.matchMedia('(prefers-color-scheme: dark)').matches);
                const next = isDark ? 'light' : 'dark';
                document.documentElement.setAttribute('data-theme', next);
                localStorage.setItem('fingerprint-theme', next);
            });

            // Load config
            try {
                const response = await fetch('/api/config');
                const config = await response.json();
                document.getElementById('baseUrl').textContent = `Base URL: ${window.location.origin}`;
                document.getElementById('tlsServerUrl').textContent = config.tls_url + '/api/fingerprint';
            } catch (e) {
                document.getElementById('baseUrl').textContent = `Base URL: ${window.location.origin}`;
            }

            // Try it buttons
            document.querySelectorAll('.try-btn').forEach(btn => {
                btn.addEventListener('click', async () => {
                    const endpoint = btn.dataset.endpoint;
                    const responseId = 'response-' + endpoint.replace('/api/', '').replace('/', '-');
                    const responseEl = document.getElementById(responseId);
                    const contentEl = document.getElementById(responseId + '-content');

                    try {
                        btn.textContent = 'Loading...';
                        const response = await fetch(endpoint);
                        const data = await response.json();
                        contentEl.textContent = JSON.stringify(data, null, 2);
                        responseEl.classList.add('visible');
                    } catch (error) {
                        contentEl.textContent = 'Error: ' + error.message;
                        responseEl.classList.add('visible');
                    } finally {
                        btn.textContent = 'Try it';
                    }
                });
            });
        });
    </script>
</body>
</html>
